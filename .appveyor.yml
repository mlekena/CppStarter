version: '{branch}-{build}'

os:
- Visual Studio 2017
- Visual Studio 2019

configuration:
- Release
- Debug

environment:
  matrix:
    - ARCH: x86
    - ARCH: x64

init:
  - set ARCH=
  - if "%ARCH%"=="x64" ( set ARCH= Win64)
  - if "%ARCH%"=="x86" ( set ARCH=)
  - echo %ARCH%
  - echo %APPVEYOR_BUILD_WORKER_IMAGE%
  - if "%APPVEYOR_BUILD_WORKER_IMAGE%"=="Visual Studio 2019" ( set GENERATOR=Visual Studio 16 2019%ARCH%)
  - if "%APPVEYOR_BUILD_WORKER_IMAGE%"=="Visual Studio 2017" ( set GENERATOR=Visual Studio 15 2017%ARCH%)
  - echo %GENERATOR%

before_build:
- md build
- cd build
- echo Calling cmake --config "%CONFIGURATION%" -G "%GENERATOR%" ..
- cmake --config "%CONFIGURATION%" -G "%GENERATOR%" ..

build_script:
- cmake --build . --config "%CONFIGURATION%"

test_script:
- cd bin/%CONFIGURATION%
- CppGoogleTestStarter.exe --gtest_output=xml:test_results.xml
- powershell ../../../scripts/appveyor.ps1